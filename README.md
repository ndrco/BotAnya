
# üß† BotAnya ‚Äî —Ä–æ–ª–µ–≤–∞—è –Ω—è—à–∞-–±–æ—Ç–∏–∫ –¥–ª—è Telegram

**BotAnya** ‚Äî —ç—Ç–æ Telegram-–±–æ—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–æ–ª–µ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ü–µ–Ω, –º–Ω–æ–≥–æ–ø–µ—Ä—Å–æ–Ω–∞–∂–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è –∏ –ø–∞–º—è—Ç–∏. –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ **Ollama** –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **ChatML**, –ø–µ—Ä–µ–≤–æ–¥, Markdown –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–æ–ª–µ–≤—ã—Ö –º–∏—Ä–æ–≤ –≤ —Å—Ç–∏–ª–µ SillyTavern.

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìú –ú–Ω–æ–≥–æ-–ø–µ—Ä—Å–æ–Ω–∞–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å JSON-—Ñ–∞–π–ª–∞–º–∏
- üé≠ –í—ã–±–æ—Ä –º–∏—Ä–∞ –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- üß† –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Ollama (–ª–æ–∫–∞–ª—å–Ω—ã—Ö LLM)
- üó£Ô∏è –ö–æ–º–∞–Ω–¥—ã: `/role`, `/scenario`, `/scene`, `/edit`, `/retry`, `/history`, `/lang`
- ‚úçÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–≤—ë–∑–¥–æ—á–µ–∫ (`*–¥–µ–π—Å—Ç–≤–∏–µ*`) –∏ markdown
- üóÉÔ∏è –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏, —Ä–æ–ª–µ–π –∏ –ª–æ–≥–æ–≤
- üåê –ü–µ—Ä–µ–≤–æ–¥ ChatML-–±–ª–æ–∫–æ–≤ –Ω–∞ –ª–µ—Ç—É (EN/RU)
- üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `config.json`
- üêæ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSONL

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏ –∏ –∑–∞–ø—É—Å—Ç–∏ [Ollama](https://ollama.com), –Ω–∞–ø—Ä–∏–º–µ—Ä —Å –º–æ–¥–µ–ª—å—é:
```bash
ollama pull pocketdoc/dans-personalityengine
```

3. –°–æ–∑–¥–∞–π `config.json` –Ω–∞ –æ—Å–Ω–æ–≤–µ `config_example.json`.

4. –ü–æ–¥–≥–æ—Ç–æ–≤—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
```
/scenarios          ‚Äî —Å—Ü–µ–Ω–∞—Ä–∏–∏ –º–∏—Ä–æ–≤ (–ø—Ä–∏–º–µ—Ä: neko_school.json)
/history.json       ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è
/user_roles.json    ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è
/chat_logs/         ‚Äî –ø–∞–ø–∫–∞ –¥–ª—è –ª–æ–≥–æ–≤
```

5. –ó–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞:
```bash
python BotAnya.py
```

---

## üß∞ –ü—Ä–∏–º–µ—Ä `config.json`

```json
{
  "ollama_url": "http://localhost:11434/api/generate",
  "model": "PocketDoc_Dans-PersonalityEngine:latest",
  "max_tokens": 12000,
  "num_predict": 300,
  "temperature": 1,
  "top_p": 0.95,
  "min_p": 0.05,
  "stop": ["User:"],
  "ChatML": true,
  "debug_mode": true,
  "tiktoken_encoding": "gpt2",
  "Telegram_bot_token": "YOUR_TELEGRAM_BOT_TOKEN",
  "scenario_file": "neko_school.json",
  "ollama_timeout": 240
}
```

---

## üí¨ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞       | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------------|----------|
| `/start`      | –ù–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ |
| `/scenario`   | –í—ã–±—Ä–∞—Ç—å –º–∏—Ä |
| `/role`       | –í—ã–±—Ä–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ |
| `/scene`      | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—é–∂–µ—Ç–Ω—É—é —Å—Ü–µ–Ω—É |
| `/history`    | –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –∏—Å—Ç–æ—Ä–∏—é |
| `/reset`      | –°–±—Ä–æ—Å–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é |
| `/edit`       | –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `/retry`      | –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç |
| `/lang`       | –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ |
| `/whoami`     | –ö—Ç–æ —Ç—ã –≤ —ç—Ç–æ–º –º–∏—Ä–µ? |
| `/help`       | –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º |

---

## üóÇ –§–æ—Ä–º–∞—Ç —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ `scenarios/neko_school.json`:

```json
{
  "world": {
    "name": "–®–∫–æ–ª–∞ –Ω–µ–∫–æ-–¥–µ–≤–æ—á–µ–∫",
    "description": "–ú–∏–ª—ã–π –º–∏—Ä —Å —É—à–∫–∞–º–∏ –∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è–º–∏",
    "emoji": "üè´",
    "intro_scene": "–¢—ã –≤—Ö–æ–¥–∏—à—å –≤ —É—é—Ç–Ω—ã–π –∫–ª–∞—Å—Å, –≥–¥–µ –∑–∞ –ø–∞—Ä—Ç–∞–º–∏ —Å–∏–¥—è—Ç –Ω–µ–∫–æ-–¥–µ–≤–æ—á–∫–∏.",
    "system_prompt": "...",
    "user_emoji": "üò∫",
    "user_role": "–£—á–µ–Ω–∏–∫ –≤ —à–∫–æ–ª–µ –Ω–µ–∫–æ-–¥–µ–≤–æ—á–µ–∫"
  },
  "characters": {
    "luna": {
      "name": "–õ—É–Ω–∞",
      "emoji": "üåô",
      "prompt": "–¢—ã –º–∏–ª–∞—è –∑–∞—Å—Ç–µ–Ω—á–∏–≤–∞—è –Ω–µ–∫–æ-–¥–µ–≤–æ—á–∫–∞...",
      "description": "–∑–∞—Å—Ç–µ–Ω—á–∏–≤–∞—è –∫–æ—à–µ—á–∫–∞"
    }
  }
}
```

---

## üîê –ü–µ—Ä–µ–≤–æ–¥ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π ChatML

–ï—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω `ChatML` –∏ `use_translation=True`, –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ prompt (`<|im_start|>user`, `assistant`, `system`) –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å—Å—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π, –∏ –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ —Ä—É—Å—Å–∫–∏–π –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `deep-translator`.

---

## üì¶ –õ–æ–≥–∏

–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `chat_logs/{user_id}_YYYY-MM-DD.jsonl` —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º, —Ä–æ–ª—å—é, –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º, —Å—Ü–µ–Ω–∞—Ä–∏–µ–º –∏ —Å–æ–¥–µ—Ä–∂–∏–º—ã–º.

---

## üß† –•—Ä–∞–Ω–∏–ª–∏—â–µ

| –§–∞–π–ª               | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------------------|------------|
| `config.json`      | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞ |
| `user_roles.json`  | –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| `history.json`     | –ò—Å—Ç–æ—Ä–∏—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ —Å—Ü–µ–Ω–∞—Ä–∏—é |
| `scenarios/*.json` | –°—Ü–µ–Ω–∞—Ä–∏–∏ –º–∏—Ä–æ–≤ –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π |
| `chat_logs/*.jsonl`| –ê—Ä—Ö–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π |

---

## ‚ù§Ô∏è –ê–≤—Ç–æ—Ä

–ë–æ—Ç —Å–æ–∑–¥–∞–Ω —Å –ª—é–±–æ–≤—å—é –¥–ª—è –≥–ª—É–±–æ–∫–∏—Ö —Ä–æ–ª–µ–≤—ã—Ö –ø–æ–≥—Ä—É–∂–µ–Ω–∏–π –≤ Telegram ü•∞  
–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ LLM –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –º–∏—Ä–∞–º–∏!
