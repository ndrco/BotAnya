# üß† BotAnya ‚Äî —Ä–æ–ª–µ–≤–∞—è –Ω—è—à–∞-–±–æ—Ç–∏–∫ –¥–ª—è Telegram

**BotAnya** ‚Äî —ç—Ç–æ Telegram-–±–æ—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–æ–ª–µ–≤—ã—Ö –º–∏—Ä–æ–≤, –º–Ω–æ–≥–æ–ø–µ—Ä—Å–æ–Ω–∞–∂–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è, –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ü–µ–Ω –∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤. –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ **Ollama**, –∞ —Ç–∞–∫–∂–µ —Å –æ–±–ª–∞—á–Ω—ã–º API **GigaChat**. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **ChatML**, –∫–æ–º–∞–Ω–¥—ã –≤ —Å—Ç–∏–ª–µ SillyTavern, –∫–∞—Å—Ç–æ–º–Ω—ã–µ JSON-—Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ –ø–∞–º—è—Ç—å.

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üåç –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∏—Ä–æ–≤ –∏ —Ä–æ–ª–µ–π (JSON-—Å—Ü–µ–Ω–∞—Ä–∏–∏)
- üßô –ú–Ω–æ–≥–æ–ø–µ—Ä—Å–æ–Ω–∞–∂–Ω—ã–π —Ä–µ–∂–∏–º —Å –≤—ã–±–æ—Ä–æ–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
- ü§ñ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ **Ollama**, **GigaChat**
- üß† –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ "–¥—É–º–∞—Ç–µ–ª—è" –∫–æ–º–∞–Ω–¥–æ–π `/service`
- üîÑ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: `/retry`, `/edit`
- üåê –ü–µ—Ä–µ–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–π: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∏ –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ —Ä—É—Å—Å–∫–∏–π –ø–æ—Å–ª–µ
- üó£Ô∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ChatML-—Ñ–æ—Ä–º–∞—Ç–∞
- üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –ª–æ–≥–æ–≤
- ‚ú® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã—Ö —Å—Ü–µ–Ω `/scene`
- ‚úçÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `*–∑–≤—ë–∑–¥–æ—á–µ–∫*`, MarkdownV2
- üì¶ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—â–µ–Ω–∏—è –≤ JSONL

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏ [Ollama](https://ollama.com) –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –º–æ–¥–µ–ª—å:
```bash
ollama pull pocketdoc/dans-personalityengine
```

3. –°–æ–∑–¥–∞–π `config.json` –∏ `credentials.json` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–æ–≤:
```
/config.json
/secrets/credentials_example.json ‚Üí /secrets/credentials.json
```

4. –ü–æ–¥–≥–æ—Ç–æ–≤—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
```
/scenarios/           ‚Äî —Å—Ü–µ–Ω–∞—Ä–∏–∏ –º–∏—Ä–æ–≤ (*.json)
/history.json         ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
/user_roles.json      ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
/chat_logs/           ‚Äî –ø–∞–ø–∫–∞ –¥–ª—è –ª–æ–≥–æ–≤
/secrets/             ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç credentials.json —Å OAuth-–∫–ª—é—á–∞–º–∏
```

5. –ó–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞:
```bash
python BotAnya.py
```

---

## ‚öôÔ∏è –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `config.json`

```json
{
  "default_service": "ollama",
  "debug_mode": true,
  "credentials_path": "secrets/credentials.json",
  "services": {
    "ollama": {
      "name": "Ollama LLM",
      "type": "ollama",
      "url": "http://localhost:11434/api/generate",
      "model": "PocketDoc_Dans-PersonalityEngine:latest",
      "chatml": true,
      "temperature": 1.0,
      "top_p": 0.95,
      "min_p": 0.05,
      "repeat_penalty": 1.1,
      "max_tokens": 7000,
      "num_predict": 2048,
      "stop": ["User:"],
      "timeout": 240,
      "tiktoken_encoding": "gpt2"
    },
    "gigachat": {
      "name": "GigaChat API",
      "type": "gigachat",
      "model": "GigaChat-Pro",
      "url": "https://gigachat.devices.sberbank.ru/api/v1/chat/completions",
      "auth_url": "https://ngw.devices.sberbank.ru:9443/api/v2/oauth",
      "scope": "GIGACHAT_API_PERS",
      "chatml": true,
      "temperature": 0.9,
      "top_p": 0.95,
      "num_predict": 1024,
      "repeat_penalty": 1.1,
      "timeout": 100
    }
  }
}
```

---

## üí¨ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞       | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------------|----------|
| `/start`      | –ù–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ |
| `/scenario`   | –í—ã–±—Ä–∞—Ç—å –º–∏—Ä |
| `/role`       | –í—ã–±—Ä–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ |
| `/scene`      | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—é–∂–µ—Ç–Ω—É—é —Å—Ü–µ–Ω—É |
| `/whoami`     | –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –∫—Ç–æ —Ç—ã –≤ —ç—Ç–æ–º –º–∏—Ä–µ |
| `/service`    | –í—ã–±—Ä–∞—Ç—å –¥–≤–∏–∂–æ–∫ (Ollama/GigaChat) |
| `/lang`       | –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫ EN/RU |
| `/retry`      | –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç–≤–µ—Ç |
| `/edit`       | –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `/history`    | –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â—É—é –∏—Å—Ç–æ—Ä–∏—é |
| `/reset`      | –°–±—Ä–æ—Å–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏ –Ω–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞ |
| `/help`       | –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º |

---

## üìñ –ü—Ä–∏–º–µ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è (JSON)

```json
{
  "world": {
    "name": "–®–∫–æ–ª–∞ –Ω–µ–∫–æ-–¥–µ–≤–æ—á–µ–∫",
    "description": "–ú–∏–ª—ã–π –º–∏—Ä —Å —É—à–∫–∞–º–∏ –∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è–º–∏",
    "emoji": "üè´",
    "intro_scene": "–¢—ã –≤—Ö–æ–¥–∏—à—å –≤ —É—é—Ç–Ω—ã–π –∫–ª–∞—Å—Å, –≥–¥–µ –∑–∞ –ø–∞—Ä—Ç–∞–º–∏ —Å–∏–¥—è—Ç –Ω–µ–∫–æ-–¥–µ–≤–æ—á–∫–∏.",
    "system_prompt": "...",
    "user_emoji": "üò∫",
    "user_role": "–£—á–µ–Ω–∏–∫ –≤ —à–∫–æ–ª–µ –Ω–µ–∫–æ-–¥–µ–≤–æ—á–µ–∫"
  },
  "characters": {
    "luna": {
      "name": "–õ—É–Ω–∞",
      "emoji": "üåô",
      "prompt": "–¢—ã –º–∏–ª–∞—è –∑–∞—Å—Ç–µ–Ω—á–∏–≤–∞—è –Ω–µ–∫–æ-–¥–µ–≤–æ—á–∫–∞...",
      "description": "–∑–∞—Å—Ç–µ–Ω—á–∏–≤–∞—è –∫–æ—à–µ—á–∫–∞"
    }
  }
}
```

---

## üåê –ü–µ—Ä–µ–≤–æ–¥ –∏ ChatML

- –ü–µ—Ä–µ–≤–æ–¥ –≤–∫–ª—é—á–∞–µ—Ç—Å—è —Ñ–ª–∞–≥–æ–º `use_translation=true` ‚Äî –ø—Ä–∏ —ç—Ç–æ–º **–≤—Å—ë —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∏ –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ —Ä—É—Å—Å–∫–∏–π –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞**.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç **ChatML**: `<|im_start|>user`, `<|im_start|>assistant`, `<|im_start|>system` –∏ –¥—Ä.

---

## üì¶ –•—Ä–∞–Ω–∏–ª–∏—â–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

| –§–∞–π–ª/–ü–∞–ø–∫–∞           | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------------------|------------|
| `config.json`        | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ |
| `secrets/`           | –ü–∞–ø–∫–∞ —Å OAuth-–∫–ª—é—á–∞–º–∏ (`credentials.json`) |
| `user_roles.json`    | –¢–µ–∫—É—â–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| `history.json`       | –ò—Å—Ç–æ—Ä–∏—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ —Å—Ü–µ–Ω–∞—Ä–∏—é |
| `scenarios/*.json`   | –°—Ü–µ–Ω–∞—Ä–∏–∏ –º–∏—Ä–æ–≤ –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π |
| `chat_logs/*.jsonl`  | –õ–æ–≥–∏ –æ–±—â–µ–Ω–∏—è (–∞—Ä—Ö–∏–≤) |

---

## ‚ù§Ô∏è –ê–≤—Ç–æ—Ä

–°–æ–∑–¥–∞–Ω —Å –ª—é–±–æ–≤—å—é –¥–ª—è —É—é—Ç–Ω—ã—Ö –∏ –≥–ª—É–±–æ–∫–∏—Ö —Ä–æ–ª–µ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤ ü•∞ 
–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ñ–∞–Ω–∞—Ç–æ–≤ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –Ω–æ–≤–µ–ª–ª, –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –≤—Å–µ–ª–µ–Ω–Ω—ã—Ö –∏ GPT-–ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π –≤ Telegram!

